{% extends 'anotacoes/base_notas.html' %}
{% load static %}

{% block content %}

<!-- Botão flutuante para adicionar nota -->
<a class="add-note-btn" id="addNoteBtn" href="{% url "note_create" %}">+</a>

<div class="notas-container">
    {% for note in notes %}
        <div class="nota-card" onclick="openNoteModal({{ note.id }})">
            <div style="flex:1">
                <div style="overflow:hidden; white-space:nowrap; text-overflow:ellipsis; max-width:100%;">
                    {{ note.content|truncatechars:85 }}
                </div>
            </div>
            <div class="nota-title">{{ note.title|default:"Sem título" }}</div>
            <div class="nota-date">{{ note.created_at|date:"d/m/Y" }}</div>
        </div>
    {% empty %}
        <div style="color:#888; font-size:1.1em;">Nenhuma nota criada ainda.</div>
    {% endfor %}
</div>

<div class="modal-overlay" id="modalOverlay" style="display: none;">
	<div class="modal-content">
	  <h2 id="noteTitle"></h2>
	  <p id="noteContent"></p>
	  <div class="form-actions">
		<button class="btn btn-secondary" onclick="closeNoteModal()">Fechar</button>
	  </div>
	</div>
  </div>

{% endblock content %}

{% block scripts %}
<script>
	let NOTES = [
    {% for note in notes %}
      {
        id: {{ note.id }},
        title: `{{ note.title|escapejs }}`,
        content: `{{ note.content|escapejs }}`
      }{% if not forloop.last %},{% endif %}
    {% endfor %}
	];

	function openNoteModal(noteId) {
		const note = NOTES.find(n => n.id === noteId);
		if (note) {
		  document.getElementById("noteTitle").innerText = note.title;
		  document.getElementById("noteContent").innerText = note.content;
		  document.getElementById("modalOverlay").style.display = "flex";
		}
	  }
	
	  function closeNoteModal() {
		document.getElementById("modalOverlay").style.display = "none";
	  }
</script>
{% endblock scripts %}